<!DOCTYPE html>
<!--TEST-->
<html>

  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Login | NothingButTyler+</title>
    
    		<link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/149272952" />
    
    <!--Button Style(s)--><link rel="stylesheet" href="//nothingbuttylerplus.glitch.me/css/button-style.css" /><link rel="stylesheet" href="//nothingbuttylerplus.glitch.me/css/submitbutton-style.css" /><link rel="stylesheet" href="//nothingbuttylerplus.glitch.me/css/main/style.css" /><link rel="stylesheet" href="//nothingbuttylerplus.glitch.me/css/textbox.css" />


  </head>

  <body><font color="white">
        <a href="/contact.html" style="text-decoration: none;">    <div style="background-color:red;text-align:center;padding:10px;margin-top:7px;font-size:12px;color: black;">Some things are still a work-in-progress. If something doesn't work, let NothingButTyler know and he will update it.</div></a>

<div class="header"> 

  <a href="/" class="logo">NothingButTyler+</a>

  <div class="header-right"> 

    <a class="active" href="/">Home</a>
    
    <a href="/signup">Sign Up</a>

    <a href="/contact.html">Contact</a> 

    <a href="/about.html">About</a>
    
    <a href="/preview.html">Preview of NothingButTyler+</a>

  </div>

</div>

<!--<div style="padding-left:20px">-->

   <div>

      <center>

        <h1>Log into NothingButTyler+</h1>

        <i>Don't have an account? Sign up <a href="/signup.html">here</a>.</i>

        <br>
        <br>

        <form id="loginForm"> 
            
            <label for="accountName">Account Name:</label>
            <input type="text" id="accountName" class="nbttextbox" required>
            <br />
            
            <label for="pin">6-digit PIN:</label>
            <input type="password" id="pin" class="nbttextbox" minlength="6" maxlength="6" required>
            <br />
            
            <button type="submit" class="button-29">Log In</button>
            <p id="error-message" style="color: red;"></p>
        </form>

        <p>Or...</p>
        
        </div>
    
    </center></font>
  </body>
  
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // ðŸš¨ CRITICAL FIX: NEW WORKING KEYS (nothingbuttylerplusv2)
    const firebaseConfig = {
      apiKey: "AIzaSyCxg9yjBpv0lwhG1dBpqKpUJRrQEXCsavI",
      authDomain: "nothingbuttylerplusv2.firebaseapp.com",
      projectId: "nothingbuttylerplusv2",
      storageBucket: "nothingbuttylerplusv2.firebasestorage.app",
      messagingSenderId: "478539772644",
      appId: "1:478539772644:web:aa99972afac494f9bd32f1",
      measurementId: "G-TBRJNP38KP"
    };
    
    const app = firebase.initializeApp(firebaseConfig);
    var auth = app.auth(); 
    
    // Attach login listener to the 'loginForm' ID
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault(); 

        const accountName = document.getElementById('accountName').value;
        const pin = document.getElementById('pin').value; // Changed ID from 'number-password' to 'pin'
        const errorMessage = document.getElementById('error-message');
        
        if (pin.length < 6) {
            errorMessage.textContent = "PIN must be 6 characters long.";
            return;
        }

        // Recreate the special email used for Authentication
        const email = `${accountName.toLowerCase().replace(/\s/g, '')}@nothingbuttylerplus.com`;

        errorMessage.textContent = ''; 

        // 1. Sign In User
        auth.signInWithEmailAndPassword(email, pin)
            .then(() => {
                console.log("Login successful. Redirecting...");
                window.location.href = "/user/dashboard";
            })
            .catch((error) => {
                errorMessage.textContent = `Login Failed: ${error.message}`;
                console.error("Login Error:", error);
            });
    });

</script>

<script src="/btn/submitbutton-script.js"></script>

</html>